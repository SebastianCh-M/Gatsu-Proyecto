{% extends 'index.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>

    {% load static %}

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/960b784d40.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet"
        href="https://firebasestorage.googleapis.com/v0/b/gatsu-fbddf.appspot.com/o/Styles.css?alt=media&token=5036f23e-a456-4dc4-9b81-7da2f7a40599">
    <!-- Bootstrap CSS -->
    <title>Detalle del Manga</title>
    <meta name="msapplication-TileColor" content="#2957ba">
    <meta name="msapplication-TileImage" content="/favicon/mstile-144x144.png">
    <meta name="msapplication-config" content="/favicon/browserconfig.xml">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="module" src="{% static 'js/main.js' %}"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Your custom styles -->
    <link rel="stylesheet"
        href="https://firebasestorage.googleapis.com/v0/b/gatsu-fbddf.appspot.com/o/Styles.css?alt=media&token=5036f23e-a456-4dc4-9b81-7da2f7a40599">
    <!-- Other meta tags -->
    <link rel="apple-touch-icon" href="/docs/5.2/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="mask-icon" href="/docs/5.2/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9">

</head>
<style>
    .img-fluid {
        width: 250px;
        height: 300px;
        justify-content: center;
        align-items: center;
        position: relative;
        display: flex;
    }

    section {
        position: relative;
        background: #202020;
        min-height: 1vh;
        overflow: hidden;
        justify-content: center;
        align-items: center;
        display: flex;
    }

    section::before {
        content: "";
        position: absolute;
        width: auto;
        height: auto;
        background: #202020;
        border-radius: 50%;
        transform: translate(-125px, -60px);
    }

    section::after {
        content: "";
        position: absolute;
        width: auto;
        height: auto;
        background: rgb(70, 67, 67);
        border-radius: 50%;
        transform: translate(-125px, -60px);
    }

    .box {
        position: relative;
        min-width: 90%;
        min-height: 90%;
        background: #202020;
        box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-right: 1px solid rgba(255, 255, 255, 0.2);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        z-index: 10;
        padding: 20px;
        backdrop-filter: blur(25px);
    }

    .box .list {
        position: relative;
        display: flex;
        padding: 10px;
        background: #202020;
        border-radius: 10px;
        margin: 10px 0;
        cursor: pointer;
        transition: 0.5s;
        overflow: hidden;
    }

    .box .list:hover {
        background: #202020;
        box-shadow: -15px 30px 50px rgba(0, 0, 0, 0.5);
        transform: scale(1.015) translateX(5px) translateY(0px);
        z-index: 500;
    }

    .box .list .content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        color: #fff;
    }

    .box .list .content .h4 {
        line-height: 1.2em;
        font-weight: 600;
        transition: 0.5s;
    }

    .box .list :hover .content h4 {
        color: black;
    }

    .box2 {
        display: flex;

    }

    .sinopsis {

        padding-left: 5px;
    }

    .capitulo-bloqueado {
        opacity: 0.6; /* Hace que el capítulo se vea más oscuro */
        pointer-events: none; /* Evita que el botón sea clickeable */
        position: relative; /* Para que el icono de candado se posicione correctamente */
    }

    .icono-candado {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px; /* Puedes ajustar el tamaño según sea necesario */
        color: #fff;
    }



    /* Estilos para la ventana emergente */
    .ventana-emergente {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Fondo oscuro semi-transparente */
        justify-content: center;
        align-items: center;
        z-index: 999; /* Asegura que esté en la parte superior */
    }

    .ventana-contenido {
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }

    .botones button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }

    .btn-pagar {
        background-color: #ff9900; /* Color de pago */
        color: #fff;
        border: none;
    }

    .btn-denegar {
        background-color: #333; /* Color para denegar */
        color: #fff;
        border: none;
    }

</style>

<body style="background-color: #202020; color: #fff;">
    <br>
    <br>
    <div class="container">
        {% if messages %}
            <div class="alert alert-info" role="alert">
                {{ messages }}
            </div>
        {% endif %}
        <div class="row">
            <div class="col-md-4">
                <!-- Contenido de la primera columna (imagen y sinopsis) -->
                <div class="box2">
                    <div class="sinopsis card"
                        style="background-color: #202020; color: #fff; border-color: #fff; padding-left: 60px; padding-top: 20px; padding-bottom: 20px; padding-right: 60px;">
                        <div class="content d-flex align-items-center align-img">
                            <img class="img-fluid col-md" src="{{ manga.portada.url }}" alt="{{ manga.nombre_manga }}">
                        </div>
                        <div class="col-md-12">
                            <h1 style="text-align: center;">{{ manga.nombre_manga.nombreManga }}</h1>

                            <a href="{% url 'manga:add_favorite' manga.id %}" class="btn btn-outline-primary"> Agregar Favorito</a>
                            <h2>Sinopsis:</h2>
                            <p>{{ manga.sinopsis }}</p>
                            <p class="Mangaka">Mangaka: {{ manga.nombre_manga.mangaka }}</p>
                            <p class="Genero">Género: {{ manga.genero }}</p>

                        </div>
                    </div>
                </div>
            </div>
            <!-- Resto del contenido -->

            <div class="col-md-8">
                <!-- Contenido de la segunda columna (capítulos) -->
                <div class="box">
                    <h3>Capitulos</h3>
                    <br>
                    {% for capitulo in capitulos %}
                        <div class="list">
                            <div class="content">
                                {% if capitulo.numero == 1 or user_is_subscribed %}
                                    <!-- Permitir acceso a primer capítulo o si el usuario está suscrito -->
                                    <a class="btn btn-danger" style="background-color: black; border-color: #fff;"
                                        href="/verCapitulo/{{capitulo.id}}">
                                        <small>Cap: {{capitulo.numero}}</small>
                                        <h4>{{ capitulo.titulo }}</h4>
                                        <a href="{% url 'manga:update_progress' manga_id=capitulo.manga.id chapter_id=capitulo.id %}">Marcar como leido</a>

                                    </a>
                                {% else %}
                                    <!-- Mostrar ventana emergente solo cuando se selecciona un capítulo -->
                                    <button class="btn btn-danger" style="background-color: black; border-color: #fff;"
                                        onclick="mostrarVentanaEmergente('{{capitulo.id}}')">
                                        <small>Cap: {{capitulo.numero}}</small>
                                        <h4>{{ capitulo.titulo }}</h4>
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Ventana emergente mejorada -->
    <div id="ventanaEmergente" class="ventana-emergente">
        <div class="ventana-contenido">
            <p>Lo siento, el contenido desde aquí en adelante es parte del contenido premium de Gatsu.</p>
            <div class="botones">
                <button class="btn-pagar" onclick="redirigirAPago()">Paga aquí</button>
                <button class="btn-denegar" onclick="cerrarVentanaEmergente()">No por ahora</button>
            </div>
        </div>
    </div>

    <!-- Script para mostrar y cerrar la ventana emergente -->
    <script>
        function mostrarVentanaEmergente(capituloId) {
            var ventanaEmergente = document.getElementById("ventanaEmergente");
            ventanaEmergente.style.display = "flex";
            // Puedes hacer algo con el capítulo seleccionado si es necesario
            // Por ejemplo, almacenarlo en una variable JavaScript o realizar alguna acción específica
            console.log("Capítulo seleccionado:", capituloId);
        }
    
        function cerrarVentanaEmergente() {
            var ventanaEmergente = document.getElementById("ventanaEmergente");
            ventanaEmergente.style.display = "none";
        }
    
        function redirigirAPago() {
            // Redirige a la URL de pago
            window.location.href = "/url-de-pago";
        }
    </script>

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script
        src="https://firebasestorage.googleapis.com/v0/b/gatsu-fbddf.appspot.com/o/main.js?alt=media&token=ff3947c9-5e68-4be6-8ca1-9bcbc97fa406"></script>
</body>
</html>

{% endblock %}